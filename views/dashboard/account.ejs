<!DOCTYPE html>
<html lang="en" class="h-full">
  <%- include("../components/header.ejs", { title: "Home" }) %>
  <script src="/assets/js/pageSpecific/dashboard.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="/assets/js/animeThyNavs.js"></script>
  <script src="/node_modules/colorthief/dist/color-thief.umd.js"></script>

  <body class="bg-neutral-900">
    <div id="modal-container"></div>

    <!-- ========== HEADER ========== -->
    <header
      class="sticky top-0 inset-x-0 flex flex-wrap md:justify-start md:flex-nowrap z-[48] w-full border-b text-sm py-2.5 bg-neutral-800 border-neutral-700"
    >
      <nav
        class="max-w-[85rem] mx-auto w-full px-4 sm:px-6 lg:px-8 flex basis-full items-center w-full mx-auto"
      >
        <div class="me-5">
          <!-- Logo -->
          <a
            class="flex-none rounded-md text-xl inline-block font-semibold focus:outline-none focus:opacity-80"
            href="#"
            aria-label="Preline"
          >
            <h1 class="font-calsans mt-1.5 text-2xl text-neutral-200">
              TransitCDN
            </h1>
          </a>
          <!-- End Logo -->
        </div>

        <div
          class="w-full flex items-center justify-end ms-auto md:justify-between gap-x-1 md:gap-x-3"
        >
          <!-- Collapse -->
          <div class="md:hidden">
            <button
              type="button"
              class="hs-collapse-toggle size-[38px] relative inline-flex justify-center items-center gap-x-2 text-sm font-semibold rounded-full border border-transparent focus:outline-none disabled:opacity-50 disabled:pointer-events-none text-white hover:bg-neutral-700 focus:bg-neutral-700"
              id="hs-secondaru-navbar-collapse"
              aria-expanded="false"
              aria-controls="hs-secondaru-navbar"
              aria-label="Toggle navigation"
              data-hs-collapse="#hs-secondaru-navbar"
            >
              <svg
                class="hs-collapse-open:hidden size-4"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <line x1="3" x2="21" y1="6" y2="6" />
                <line x1="3" x2="21" y1="12" y2="12" />
                <line x1="3" x2="21" y1="18" y2="18" />
              </svg>
              <svg
                class="hs-collapse-open:block shrink-0 hidden size-4"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M18 6 6 18" />
                <path d="m6 6 12 12" />
              </svg>
              <span class="sr-only">Toggle navigation</span>
            </button>
          </div>
          <!-- End Collapse -->

          <div class="hidden md:block">
            <!-- Search Input -->
          </div>

          <div class="flex flex-row items-center justify-end gap-1">
            <button
              type="button"
              class="size-[38px] relative inline-flex justify-center items-center gap-x-2 text-sm font-semibold rounded-full border border-transparent focus:outline-none disabled:opacity-50 disabled:pointer-events-none text-white hover:bg-neutral-700 focus:bg-neutral-700"
            >
              <svg
                class="shrink-0 size-4"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9" />
                <path d="M10.3 21a1.94 1.94 0 0 0 3.4 0" />
              </svg>
              <span class="sr-only">Notifications</span>
            </button>

            <button
              type="button"
              class="size-[38px] relative inline-flex justify-center items-center gap-x-2 text-sm font-semibold rounded-full border border-transparent focus:outline-none disabled:opacity-50 disabled:pointer-events-none text-white hover:bg-neutral-700 focus:bg-neutral-700"
            >
              <svg
                class="shrink-0 size-4"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
              </svg>
              <span class="sr-only">Activity</span>
            </button>

              <a
                id="hs-dropdown-account"href="/dashboard/account"
                type="button"
                class="size-[38px] inline-flex justify-center items-center gap-x-2 text-sm font-semibold rounded-full border border-transparent text-neutral-300 focus:outline-none disabled:opacity-50 disabled:pointer-events-none dark:text-white"
                aria-haspopup="menu"
                aria-expanded="false"
                aria-label="Dropdown"
              >
                <img
                  class="shrink-0 size-[38px] rounded-full"
                  src="/uploads/@<%=  data.name %>/avatar"
                  alt="Avatar"
                />
              </a>

          </div>
        </div>
      </nav>
    </header>
    <!-- ========== END HEADER ========== -->

    <!-- ========== MAIN CONTENT ========== -->
    <main id="content">
      <!-- Secondary Navbar -->
      <div class="md:py-5 md:border-b bg-neutral-800 border-neutral-700">
        <nav
          class="relative max-w-[85rem] w-full mx-auto md:flex md:items-center md:gap-3 px-4 sm:px-6 lg:px-8"
        >
          <!-- Collapse -->
          <div
            id="hs-secondaru-navbar"
            class="hs-collapse hidden overflow-hidden transition-all duration-300 basis-full grow md:block"
            aria-labelledby="hs-secondaru-navbar-collapse"
          >
            <div
              class="overflow-hidden overflow-y-auto max-h-[75vh] [&::-webkit-scrollbar]:w-2 [&::-webkit-scrollbar-thumb]:rounded-full [&::-webkit-scrollbar-track]:bg-neutral-700 [&::-webkit-scrollbar-thumb]:bg-neutral-500"
            >
              <div
                class="py-2 md:py-0 flex flex-col md:flex-row md:items-center gap-y-0.5 md:gap-y-0 md:gap-x-6"
              >
                <a
                  class="py-2 md:py-0 flex items-center font-medium text-sm focus:outline-none text-neutral-400 hover:text-neutral-200/80 transition-colors"
                  href="/dashboard"
                  aria-current="page"
                >
                  <svg
                    class="shrink-0 size-4 me-3 md:me-2 block md:hidden"
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8" />
                    <path
                      d="M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"
                    />
                  </svg>
                  Dashboard
                </a>
                <a
                class="py-2 md:py-0 flex items-center font-medium text-sm focus:outline-none text-neutral-400 hover:text-neutral-200/80 transition-colors"
                href="/dashboard/files"
                  aria-current="page"
                >
                  <svg
                    class="shrink-0 size-4 me-3 md:me-2 block md:hidden"
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8" />
                    <path
                      d="M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"
                    />
                  </svg>
                  Your Files
                </a>

                <a
                  class="py-2 md:py-0 flex items-center font-medium text-sm focus:outline-none text-neutral-400 hover:text-neutral-200/80 transition-colors"
                  href="/dashboard/files/upload"
                  aria-current="page"
                >
                  <svg
                    class="shrink-0 size-4 me-3 md:me-2 block md:hidden"
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8" />
                    <path
                      d="M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"
                    />
                  </svg>
                  Upload Files
                </a>

                <a
                  class="hidden py-2 md:py-0 flex items-center font-medium text-sm focus:outline-none text-neutral-400 hover:text-neutral-200/80 transition-colors"
                  href="/dashboard/short"
                  aria-current="page"
                >
                  <svg
                    class="shrink-0 size-4 me-3 md:me-2 block md:hidden"
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8" />
                    <path
                      d="M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"
                    />
                  </svg>
                  Shortend URL's
                </a>

                <!-- Dropdown -->
                <div
                  class="hidden hs-dropdown [--strategy:static] md:[--strategy:fixed] [--adaptive:none] [--is-collapse:true] md:[--is-collapse:false]"
                >
                  <button
                    id="hs-secondaru-navbar-dropdown"
                    type="button"
                    class="hs-dropdown-toggle w-full py-2 md:py-0 flex items-center font-medium text-sm focus:outline-none text-neutral-400 hover:text-neutral-200/80 transition-colors"
                    aria-haspopup="menu"
                    aria-expanded="false"
                    aria-label="Dropdown"
                  >
                    <svg
                      class="shrink-0 size-4 me-3 md:me-2 block md:hidden"
                      xmlns="http://www.w3.org/2000/svg"
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <path d="m3 10 2.5-2.5L3 5" />
                      <path d="m3 19 2.5-2.5L3 14" />
                      <path d="M10 6h11" />
                      <path d="M10 12h11" />
                      <path d="M10 18h11" />
                    </svg>
                    Admin
                    <svg
                      class="hs-dropdown-open:rotate-180 md:hs-dropdown-open:rotate-0 duration-300 shrink-0 size-4 ms-auto md:ms-1"
                      xmlns="http://www.w3.org/2000/svg"
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <path d="m6 9 6 6 6-6" />
                    </svg>
                  </button>

                  <div
                    class="hs-dropdown-menu transition-[opacity,margin] duration-[0.1ms] md:duration-[150ms] hs-dropdown-open:opacity-100 opacity-0 relative w-full md:w-52 hidden z-10 top-full ps-7 md:ps-0 md:rounded-lg md:shadow-md before:absolute before:-top-4 before:start-0 before:w-full before:h-5 md:after:hidden after:absolute after:top-1 after:start-2 after:w-0.5 after:h-[calc(100%-0.25rem)] md:bg-neutral-800/55 after:bg-neutral-700/55 filter backdrop-blur-md"
                    role="menu"
                    aria-orientation="vertical"
                    aria-labelledby="hs-secondaru-navbar-dropdown"
                  >
                    <div class="py-1 md:px-1 space-y-0.5">
                      <a
                        class="py-1.5 md:px-2 flex items-center text-sm text-neutral-300 hover:text-gray-500 focus:outline-none focus:text-gray-500 dark:text-neutral-200 dark:hover:text-neutral-500 dark:focus:text-neutral-500"
                        href="/dashboard/admin/users"
                      >
                        User
                      </a>

                      <a
                        class="py-1.5 md:px-2 flex items-center text-sm text-neutral-300 hover:text-gray-500 focus:outline-none focus:text-gray-500 dark:text-neutral-200 dark:hover:text-neutral-500 dark:focus:text-neutral-500"
                        href="/dashboard/admin/files"
                      >
                        All Files
                      </a>

                      <a
                        class="py-1.5 md:px-2 flex items-center text-sm text-neutral-300 hover:text-gray-500 focus:outline-none focus:text-gray-500 dark:text-neutral-200 dark:hover:text-neutral-500 dark:focus:text-neutral-500"
                        href="/dashboard/admin/shorts"
                      >
                        All URL's
                      </a>
                    </div>
                  </div>
                </div>
                <!-- End Dropdown -->
              </div>
            </div>
          </div>
          <!-- End Collapse -->
        </nav>
      </div>
      <!-- End Secondary Navbar -->

      <div
        class="max-w-[85rem] min-h-[75rem] mx-auto py-10 px-4 sm:px-6 lg:px-8"
      >
        <div class="divide-y divide-white/5">
          <div
            class="grid max-w-7xl grid-cols-1 gap-x-8 gap-y-10 px-4 py-16 sm:px-6 md:grid-cols-3 lg:px-8"
          >
            <div>
              <h2 class="text-base font-semibold leading-7 text-white">
                Personal Information
              </h2>
              <p class="mt-1 text-sm leading-6 text-neutral-400">
                Use a permanent address where you can receive mail.
              </p>
            </div>

            <div class="md:col-span-2">
              <div
                class="grid grid-cols-1 gap-x-6 gap-y-8 sm:max-w-xl sm:grid-cols-6"
              >
                <div class="col-span-full flex items-center gap-x-8">
                  <img
                    src="/uploads/@<%=  data.name %>/avatar"
                    alt=""
                    class="h-24 w-24 flex-none rounded-lg bg-neutral-800 object-cover"
                  />
                  <div>
                    <div class="max-w-sm">
                      <label class="block">
                        <span class="sr-only">Choose profile photo</span>
                        <input
                          type="file"
                          name="file"
                          id="file"
                          class="block w-full text-sm text-gray-500 file:me-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-white/10 file:text-neutral-200 hover:file:bg-white/30 file:disabled:opacity-50 file:disabled:pointer-events-none"
                        />
                      </label>
                    </div>
                    <p class="mt-2 text-xs leading-5 text-neutral-400">
                      JPG, GIF or PNG. 1MB max.
                    </p>
                  </div>
                </div>

                <div class="sm:col-span-3">
                  <label
                    for="first-name"
                    class="block text-sm font-medium leading-6 text-white"
                    >Name</label
                  >
                  <div class="mt-2">
                    <input
                      type="text"
                      name="first-name"
                      id="first-name"
                      autocomplete="given-name"
                      class="block w-full rounded-md border-0 bg-white/5 py-1.5 text-white shadow-sm ring-1 ring-inset ring-white/10 focus:ring-2 focus:ring-inset focus:ring-indigo-500 sm:text-sm sm:leading-6"
                    />
                  </div>
                </div>

                <div class="sm:col-span-3">
                  <label
                    for="last-name"
                    class="block text-sm font-medium leading-6 text-white"
                    >Email address</label
                  >
                  <div class="mt-2">
                    <input
                      type="text"
                      name="Email address"
                      id="email"
                      autocomplete="family-name"
                      class="block w-full rounded-md border-0 bg-white/5 py-1.5 text-white shadow-sm ring-1 ring-inset ring-white/10 focus:ring-2 focus:ring-inset focus:ring-indigo-500 sm:text-sm sm:leading-6"
                    />
                  </div>
                </div>

                <div class="col-span-full">
                  <label
                    for="username"
                    class="block text-sm font-medium leading-6 text-white"
                    >Username</label
                  >
                  <div class="mt-2">
                    <div
                      class="flex rounded-md bg-white/5 ring-1 ring-inset ring-white/10 focus-within:ring-2 focus-within:ring-inset focus-within:ring-indigo-500"
                    >
                      <span
                        class="flex select-none items-center pl-3 text-neutral-400 sm:text-sm"
                        >transit.ambrosia.gg/@</span
                      >
                      <input
                        type="text"
                        name="username"
                        id="username"
                        autocomplete="username"
                        class="flex-1 border-0 bg-transparent py-1.5 pl-1 text-white focus:ring-0 sm:text-sm sm:leading-6"
                        placeholder="duck"
                      />
                    </div>
                  </div>
                </div>
              </div>

              <div class="mt-8 flex">
                <button
                onclick="send()"
                  class="rounded-md bg-indigo-500 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500"
                >
                  Save
                </button>
              </div>
            </div>
          </div>

          <div
            class="grid max-w-7xl grid-cols-1 gap-x-8 gap-y-10 px-4 py-16 sm:px-6 md:grid-cols-3 lg:px-8"
          >
            <div>
              <h2 class="text-base font-semibold leading-7 text-white">
                Change password
              </h2>
              <p class="mt-1 text-sm leading-6 text-neutral-400">
                Update your password associated with your account.
              </p>
            </div>

            <div class="md:col-span-2">
              <div
                class="grid grid-cols-1 gap-x-6 gap-y-8 sm:max-w-xl sm:grid-cols-6"
              >
                <div class="col-span-full">
                  <label
                    for="current-password"
                    class="block text-sm font-medium leading-6 text-white"
                    >Current password</label
                  >
                  <div class="mt-2">
                    <input
                      id="current-password"
                      name="current_password"
                      type="password"
                      autocomplete="current-password"
                      class="block w-full rounded-md border-0 bg-white/5 py-1.5 text-white shadow-sm ring-1 ring-inset ring-white/10 focus:ring-2 focus:ring-inset focus:ring-indigo-500 sm:text-sm sm:leading-6"
                    />
                  </div>
                </div>

                <div class="col-span-full">
                  <label
                    for="new-password"
                    class="block text-sm font-medium leading-6 text-white"
                    >New password</label
                  >
                  <div class="mt-2">
                    <input
                      id="new_password"
                      name="new_password"
                      type="password"
                      autocomplete="new-password"
                      class="block w-full rounded-md border-0 bg-white/5 py-1.5 text-white shadow-sm ring-1 ring-inset ring-white/10 focus:ring-2 focus:ring-inset focus:ring-indigo-500 sm:text-sm sm:leading-6"
                    />
                  </div>
                </div>

                <div class="col-span-full">
                  <label
                    for="confirm-password"
                    class="block text-sm font-medium leading-6 text-white"
                    >Confirm password</label
                  >
                  <div class="mt-2">
                    <input
                      id="confirm-password"
                      name="confirm_password"
                      type="password"
                      autocomplete="new-password"
                      class="block w-full rounded-md border-0 bg-white/5 py-1.5 text-white shadow-sm ring-1 ring-inset ring-white/10 focus:ring-2 focus:ring-inset focus:ring-indigo-500 sm:text-sm sm:leading-6"
                    />
                  </div>
                </div>
              </div>

              <div class="mt-8 flex">
                <button
                  onclick="reset()"
                  class="rounded-md bg-indigo-500 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500"
                >
                  Save
                </button>
              </div>
            </div>
          </div>

          <div
            class="grid max-w-7xl grid-cols-1 gap-x-8 gap-y-10 px-4 py-16 sm:px-6 md:grid-cols-3 lg:px-8"
          >
            <div>
              <h2 class="text-base font-semibold leading-7 text-white">
                Delete account
              </h2>
              <p class="mt-1 text-sm leading-6 text-neutral-400">
                No longer want to use our service? You can delete your account
                here. This action is not reversible. All information related to
                this account will be deleted permanently.
              </p>
            </div>

            <div class="flex items-start md:col-span-2">
              <button
                type="submit"
                class="rounded-md bg-red-500 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-400"
              >
                Yes, delete my account
              </button>
            </div>
          </div>
        </div>
      </div>
    </main>
    <!-- ========== END MAIN CONTENT ========== -->
    <script>
      const fn = document.getElementById("first-name");
      const file = document.getElementById("file");
      const email = document.getElementById("email");
      const username = document.getElementById("username");
      document.addEventListener("DOMContentLoaded", async () => {
        try {
          const response = await axios.get("/api/user/info/@me");
          fn.value = response.data.name;
          username.placeholder = response.data.slug;
          email.value = response.data.email
            ? response.data.email
            : "johndoe@example.com";
        } catch (error) {
          console.error("Error fetching user info:", error);
        }
      });

      function send() {
        if (file.files) {
          const formData = new FormData();
          formData.append("file", file.files[0]); // 'file' is the key expected by the server

          const response = axios.post("/api/upload/avatar", formData, {
            headers: {
              "Content-Type": "multipart/div-data",
            },
          });
        }

        axios.patch("/api/user/edit/@me", { name: fn.value, email: email.value, username: username.value || username.placeholder }).then((response) => {
          loadModal(response.data.type, response.data.message, true, "response.data")
        })
      }

      function reset() {
        const newpassword = document.getElementById("new_password")
        const confirmpassword = document.getElementById("confirm-password")
        const oldpassword = document.getElementById("current-password")

        if (!newpassword.value) {
          loadModal("error", "You forgot to enter the new password", true, "response.data")
          return;
        }

        if (!confirmpassword.value) {
          loadModal("error", "You forgot to confir, the new password", true, "response.data")
          return;
        }

        if (!oldpassword.value) {
          loadModal("error", "You forgot to enter the current password", true, "response.data")
          return;
        }

        if (confirmpassword.value != newpassword.value) {
          loadModal("error", "Wrong password for confirm!", true, "response.data")
          return;
        }
        
        axios.patch("/api/user/edit/@me/password", { cp: confirmpassword.value, password: btoa(confirmpassword.value).toString().replace('==', "<%= encryptKEY %>") }).then((response) => {
          loadModal(response.data.type, response.data.message, true, "response.data")
          window.location.reload
        })

      }
    </script>
  </body>
</html>
